<html>

<style>

.Hidden {
    display: none;
}

.DiceRollerMain {
    display: inline-table;
    width: 50%;
    height: 10%;
    margin-bottom: 1%;
    background-color: wheat;
    border: 1px solid black;
}
.DiceRollerMain input, button, p {
    display: inline-flex;
    margin: 0.5%;
    background-color: antiquewhite;
    border-collapse: collapse;
    border: 1px solid black;
}

.DiceRollerMain input[type="text"][disabled]{
    color: black;
}
.DiceRollerMain button:hover{
    background-color: rgb(230, 215, 195);
}

.DiceRollerTop {
    display: flex;
    width: 100%;
    height: 33%;
}
.DiceRollerTop input{
    width: 50%;
}
.DiceRollerTop :nth-child(1n){
    margin: 0% !important;
    border-width: 0px 1px 1px 0px !important;
}
.DiceRollerTop :last-child{
    border-width: 0px 0px 1px 0px !important;
}
.DiceRollerTop button{
    width: 20%;
    height: 100%;
}

.DiceRollerTopSelected {
    background-color: wheat !important;
    border: 1px solid black !important;
    border-bottom: 0px !important;
}
.DiceRollerTopSelected:hover{
    background-color: rgb(225, 202, 159) !important;
}

.selctedDiv {
    display: block;
    width: 100%;
    height: 100%;
}
.unslectedDiv {
    display: none;
    width: 0%;
    height: 0%;
}

.selctedDiv p {
    margin: 0.5%;
    width: 40%;
    max-height: 33%;
}
.selctedDiv :first-child input {
    width: 20%;
    height: 25%;
}

.Log {
    display: inline-table;
    width: 40%;
    height: 10%;
    margin-bottom: 1%;
    background-color: wheat;
    border: 1px solid black;
}
.Log p {
    display: inline-flex;
    margin: 0.5%;
    background-color: antiquewhite;
    border-collapse: collapse;
    border: 1px solid black;
}

</style>

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="../assets/icon.png">
    <link rel="stylesheet" href="../assets/style_main.css">
    <script src="../assets/script_main.js"></script>
    <title>Digital Dice Roller</title>
</head>

<body>
    <header>
        <div onclick="side_bar_func()" class="side_menu_button"><img src="./../assets/icon_cog.png" alt=""></div>
        <div onclick="go_to('main/main.html')">Main Page</div>
        <div onclick="go_to('main/mechanics.html')">Mechanics</div>
        <div onclick="go_to('main/abilities.html')">Abilities</div>
        <div onclick="go_to('main/extra.html')">Extra</div>
    </header>
    <side_orb id="side_orb" onclick="side_bar_func(true)"></side_orb>
    <side_menu id="side_menu"></side_menu>
    <main id="main" onclick="side_bar_func(false)">
        <h1>DIGITAL DICE ROLLER</h1>
        <hr/>
        <br/>
        <input type="button" value="Save">
        <input type="button" value="Load">
        <input type="button" value="Add Dice Roller" onclick="addDiceRoller()">
        <input type="button" value="Delete Dice Roller">
        <br/><br/><hr>
        <div id="0">
            <div class="Hidden">
                <div class="DiceRollerTop">
                    <input type="text" name="Name" placeholder="Name" onchange="DiceRollerArray[this.parentElement.parentElement.parentElement.id].name = this.value">
                    <button class="DiceRollerTopSelected" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(1)">d10</button>
                    <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(2)">Damage</button>
                    <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(3)">Stable</button>
                </div>
                <div class="selctedDiv">
                    <div style="display: flex;">
                        <p></button></p>
                        <input type="text" name="d10Modifier" placeholder="Modifier">
                        <input type="text" name="d10Bonus" placeholder="Bonus">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(0, 10)">d10</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(0, 1)">Advantage</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(0, 2)">Disadvantage</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(0)">Roll</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(0)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ResultLog(0)">Log</button>
                    </div>
                </div>
                <div class="unslectedDiv">
                    <div style="display: flex;">
                        <p></p>
                        <input type="text" name="DamageMultiplier" placeholder="Multiplier">
                        <input type="text" name="DamageBonus" placeholder="Bonus">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 4)">d4</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 6)">d6</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 8)">d8</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 10)">d10</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 12)">d12</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 20)">d20</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 3)">×2</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(1, 5)">×3</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(1)">Roll</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(1)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ResultLog(1)">Log</button>
                    </div>
                </div>
                <div class="unslectedDiv">
                    <div style="display: flex;">
                        <p></p>
                        <input type="text" name="StableMultiplier" placeholder="Multiplier">
                        <input type="text" name="StableModifier" placeholder="Modifier">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(2, 10)">d10</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(2, 1)">Advantage</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].sendDice(2, 2)">Disadvantage</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(2)">Roll</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(2)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ResultLog(2)">Log</button>
                    </div>
                </div>
            </div>
            <div class="Hidden"><p>The Roll Log is empty</p></div>
        </div>
        <button class="Hidden" id="DiceButton" name="" value="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].removeElement(this.name, this.value), this.remove()"></button>
    </main>
</body>

<script>

class diceRoller {
    constructor(id) {
        this.id = id;
        this.name = "";
        this.CurrentRollerType = 1;
        this.doc = document.getElementById(id);
        this.DiceBoxes = [ [0], [0], [0] ];
        this.DiceBoxesIndex = [ 1, 1, 1 ];
        this.Multiplier = [ 1, 1, 1 ];
        this.Log = [ [], [], [] ];
        this.LogOpened = false;
    }
    switchRollerType(i) {
        if (this.CurrentRollerType != i) {
            this.doc.children[0].children[0].children[this.CurrentRollerType].className = "";
            this.doc.children[0].children[0].children[i].className = "DiceRollerTopSelected";
            this.doc.children[0].children[this.CurrentRollerType].className = "unslectedDiv";
            this.doc.children[0].children[i].className = "selctedDiv";
            this.CurrentRollerType = i;
        }
    }
    sendDice(i, Dice) {
        switch (Dice) {
            case 1: this.addDice(i, Dice); this.Multiplier[i] = 2; break;
            case 2: this.addDice(i, Dice); this.Multiplier[i] = 0.5; break;
            case 3: this.addDice(i, Dice); this.Multiplier[i] = 2; break;
            case 5: this.addDice(i, Dice); this.Multiplier[i] = 3; break;
            default: this.addDice(i, Dice);
        }
    }
    addDice(i, Dice) {
        if ([1, 2, 3, 5].includes(Dice)) {
            if (this.doc.children[0].children[i+1].children[0].children[0].getElementsByTagName("*")[0] == undefined) {}
            else if (["ADV", "DADV", "×2", "×3"].includes(this.doc.children[0].children[i+1].children[0].children[0].getElementsByTagName("*")[0].textContent)) this.removeElement(i, 0);
        }
        DiceButton = document.getElementById("DiceButton").cloneNode(true);
        DiceButton.name = i;
        DiceButton.className = "";
        if ([1, 2, 3, 5].includes(Dice)) {
            DiceButton.value = 0;
        } else {
            this.DiceBoxes[i].push(Dice);
            DiceButton.value = this.DiceBoxesIndex[i];
            this.DiceBoxesIndex[i] += 1;
        }
        switch (Dice) {
        case 1: DiceButton.innerHTML = "ADV"; break;
        case 2: DiceButton.innerHTML = "DADV"; break;
        case 3: DiceButton.innerHTML = "×2"; break;
        case 5: DiceButton.innerHTML = "×3"; break;
        default: DiceButton.innerHTML = "d"+Dice;
        }
        if ([1, 2, 3, 5].includes(Dice)) this.doc.children[0].children[i+1].children[0].children[0].insertBefore(DiceButton, this.doc.children[0].children[i+1].children[0].children[0].children[0]);
        else this.doc.children[0].children[i+1].children[0].children[0].appendChild(DiceButton);
    }
    removeElement(i, Dice) {
        if (Dice == 0) {this.Multiplier[i] = 1; this.doc.children[0].children[1*i+1].children[0].children[0].getElementsByTagName("*")[0].remove()}
        else delete this.DiceBoxes[i][Dice];
    }
    CalculateResult(index) {
        let Modifiers = this.doc.children[0].children[index+1].children[0].children[1].value.split(" ").filter(a => a);
        let Bonus = this.doc.children[0].children[index+1].children[0].children[2].value.split(" ").filter(a => a);
        let DiceBox = this.DiceBoxes[index].filter(a => a);
        let Result = [];

        if (index == 1) {if (Modifiers.length < 1) Modifiers.push(1)} else {if (Modifiers.length < 1) Modifiers.push(0)}
        for (let i = 0; i < Modifiers.length; i++) if (Bonus[i] == undefined) Bonus.push(0);
        for (let i = 0; i < DiceBox.length; i++) {
            Result.push([]);
            let rolledDice = Math.floor(Math.random() * DiceBox[i] + 1);
            if (index == 0) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor(((rolledDice * Math.max(1, Math.floor(Modifiers[j] * 0.2))) + Modifiers[j]*1 + Bonus[j]*1) * this.Multiplier[index]));
                }
            } else if (index == 1) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor((rolledDice * Modifiers[j]*1 + Bonus[j]*1) * this.Multiplier[index]));
                }
            } else if (index == 2) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor((rolledDice * this.Multiplier[index]) + Modifiers[j]*1 + Bonus[j]*1));
                }
            }
        }
        if (Result != "") this.doc.children[0].children[index+1].children[0].children[3].value = Result.join("|");
        if (Result != "") this.Log[index].push(Result.join("|"));

        if (this.LogOpened == true) {
            if (this.Log[index].length == 0) {
                this.doc.children[1].innerHTML = "<p>The Roll Log is empty</p>";
            } else {
                let LogArray = [];
                for (let i = 0; i < this.Log[index].length; i++) LogArray.push("<p>[" + this.Log[index][i] + "]</p>");
                this.doc.children[1].innerHTML = LogArray.join(" ");
            }
            this.doc.children[1].innerHTML = LogArray.join(" ");
        }
    }
    ClearBox(i) {
        this.DiceBoxes[i] = [0];
        this.DiceBoxesIndex[i] = [1];
        this.Multiplier[i] = [1];
        this.doc.children[0].children[i+1].children[0].children[0].innerHTML = "";
        this.doc.children[0].children[i+1].children[0].children[1].value = "";
        this.doc.children[0].children[i+1].children[0].children[2].value = "";
        this.doc.children[0].children[i+1].children[0].children[3].value = "Result";
    }
    ResultLog(index) {
        if (this.LogOpened == false) {
            this.LogOpened = true;
            this.doc.children[1].className = "Log";

            if (this.Log[index].length == 0) {
                this.doc.children[1].innerHTML = "<p>The Roll Log is empty</p>";
            } else {
                let LogArray = [];
                for (let i = 0; i < this.Log[index].length; i++) LogArray.push("<p>[" + this.Log[index][i] + "]</p>");
                this.doc.children[1].innerHTML = LogArray.join(" ");
            }
            this.doc.children[1].innerHTML = LogArray.join(" ");
        } else {
            this.LogOpened = false;
            this.doc.children[1].className = "Hidden";
        }
    }
}

var NumOfDiceRollers = 0;
let DiceRollerArray = [0];
function addDiceRoller() {
    NumOfDiceRollers += 1;
    DiceRoller = document.getElementById(0).cloneNode(true);
    DiceRoller.id = NumOfDiceRollers;
    DiceRoller.children[0].className = "DiceRollerMain";
    document.getElementById("main").append(DiceRoller);
    DiceRollerArray.push(new diceRoller(NumOfDiceRollers));
} addDiceRoller();

</script>

</html>