<html>

<style>

.Hidden {
    display: none;
}

.DiceRollerMain {
    width: 30%;
    height: 10%;
    background-color: wheat;
    border: 1px solid black;
}
.DiceRollerMain input, button, p {
    display: inline-flex;
    margin: 1.0%;
    background-color: antiquewhite;
    border-collapse: collapse;
    border: 1px solid black;
}
.DiceRollerMain input[type="text"][disabled]{
    color: black;
}
.DiceRollerMain button:hover{
    background-color: rgb(230, 215, 195);
}

.DiceRollerTop {
    display: flex;
    width: 100%;
    height: 33%;
}
.DiceRollerTop input{
    width: 50%;
}
.DiceRollerTop :nth-child(1n){
    margin: 0% !important;
    border-width: 0px 1px 1px 0px !important;
}
.DiceRollerTop :last-child{
    border-width: 0px 0px 1px 0px !important;
}
.DiceRollerTop button{
    width: 20%;
    height: 100%;
}

.DiceRollerTopSelected {
    background-color: wheat !important;
    border: 1px solid black !important;
    border-bottom: 0px !important;
}
.DiceRollerTopSelected:hover{
    background-color: rgb(225, 202, 159) !important;
}

.selctedDiv {
    display: block;
    width: 100%;
    height: 100%;
}
.unslectedDiv {
    display: none;
    width: 0%;
    height: 0%;
}

.selctedDiv p {
    margin: 0.8%;
    width: 40%;
    max-height: 33%;
}
.selctedDiv :first-child input {
    width: 20%;
    height: 25%;
}

</style>

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="../assets/icon.png">
    <link rel="stylesheet" href="../assets/style_main.css">
    <script src="../assets/script_main.js"></script>
    <title>Digital Dice Roller</title>
</head>

<body>
    <header>
        <div onclick="side_bar_func()" class="side_menu_button"><img src="./../assets/icon_cog.png" alt=""></div>
        <div onclick="go_to('main/main.html')">Main Page</div>
        <div onclick="go_to('main/mechanics.html')">Mechanics</div>
        <div onclick="go_to('main/abilities.html')">Abilities</div>
        <div onclick="go_to('main/extra.html')">Extra</div>
    </header>
    <side_orb id="side_orb" onclick="side_bar_func(true)"></side_orb>
    <side_menu id="side_menu"></side_menu>
    <main id="main" onclick="side_bar_func(false)">
        <h1>DIGITAL DICE ROLLER</h1>
        <hr/>
        <br/>
        save button here
        <button onclick="addDiceRoller()">adasdasdasdasd</button>
        <br/><br/><hr>
        <div class="Hidden" id="0">
            <div class="DiceRollerTop">
                <input type="text" name="Name" placeholder="Name">
                <button class="DiceRollerTopSelected" onclick="DiceRollerArray[this.parentElement.parentElement.id].switchRollerType(1)">d10</button>
                <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.id].switchRollerType(2)">Damage</button>
                <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.id].switchRollerType(3)">Stable</button>
            </div>
            <div class="selctedDiv">
                <div style="display: flex;">
                    <p></button></p>
                    <input type="text" name="d10Modifier" placeholder="Modifier">
                    <input type="text" name="d10Bonus" placeholder="Bonus">
                    <input type="text" value="Result" disabled>
                </div>
                <div style="display: flex;">
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(0, 10)">d10</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(0, 1)">Advantage</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(0, 2)">Disadvantage</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].CalculateResult(1)">Roll</button>
                    <button>Clear</button>
                    <button>Log</button>
                </div>
            </div>
            <div class="unslectedDiv">
                <div style="display: flex;">
                    <p></p>
                    <input type="text" name="DamageMultiplier" placeholder="Multiplier">
                    <input type="text" name="DamageBonus" placeholder="Bonus">
                    <input type="text" value="Result" disabled>
                </div>
                <div style="display: flex;">
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 4)">d4</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 6)">d6</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 8)">d8</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 10)">d10</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 12)">d12</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 20)">d20</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 3)">×2</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].addDice(1, 5)">×3</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].CalculateResult(1)">Roll</button>
                    <button>Clear</button>
                    <button>Log</button>
                </div>
            </div>
            <div class="unslectedDiv">
                <div style="display: flex;">
                    <p></p>
                    <input type="text" name="StableMultiplier" placeholder="Multiplier">
                    <input type="text" name="StableModifier" placeholder="Modifier">
                    <input type="text" value="Result" disabled>
                </div>
                <div style="display: flex;">
                    <button onclick="addDice(this.parentElement.parentElement.parentElement.id, 3, 'd10')">d10</button>
                    <button onclick="addDice(this.parentElement.parentElement.parentElement.id, 3, 'ADV')">Advantage</button>
                    <button onclick="addDice(this.parentElement.parentElement.parentElement.id, 3, 'DADV')">Disadvantage</button>
                    <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].CalculateResult(3)">Roll</button>
                    <button>Clear</button>
                    <button>Log</button>
                </div>
            </div>
        </div>
        <button class="Hidden" id="DiceButton" name="" value="" onclick="delete DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].DiceBoxes[this.name][this.value], this.remove()"></button>
    </main>
</body>

<script>

class diceRoller {
    constructor(id) {
        this.id = id;
        this.name = "";
        this.CurrentRollerType = 1;
        this.doc = document.getElementById(id);
        this.DiceBoxes = [ [], [], [] ]
        this.DiceBoxesIndex = [ 0, 0, 0 ]
    }
    switchRollerType(i) {
        if (this.CurrentRollerType != i) {
            this.doc.children[0].children[this.CurrentRollerType].className = "";
            this.doc.children[0].children[i].className = "DiceRollerTopSelected";
            this.doc.children[this.CurrentRollerType].className = "unslectedDiv";
            this.doc.children[i].className = "selctedDiv";
            this.CurrentRollerType = i;
        }
    }
    addDice(i, Dice) {
        if ([1, 2, 3, 5].includes(Dice) && this.DiceBoxes[i].includes(Dice)) {}
        else {
            DiceButton = document.getElementById("DiceButton").cloneNode(true);
            this.DiceBoxes[i].push(Dice);
            DiceButton.name = i;
            DiceButton.value = this.DiceBoxesIndex[i];
            this.DiceBoxesIndex[i] += 1
            DiceButton.className = "";
            switch (Dice) {
            case 1: DiceButton.innerHTML = "ADV"; break;
            case 2: DiceButton.innerHTML = "DADV"; break;
            case 3: DiceButton.innerHTML = "×2"; break;
            case 5: DiceButton.innerHTML = "×3"; break;
            default: DiceButton.innerHTML = "d"+Dice;
            }
            if ([1, 2, 3, 5].includes(Dice)) {this.doc.children[i+1].children[0].children[0].insertBefore(DiceButton, this.doc.children[i+1].children[0].children[0].children[0]);}
            else {this.doc.children[i+1].children[0].children[0].appendChild(DiceButton);}
        }
    }
    CalculateResult(i) {
        let Modifiers = this.doc.children[i+1].children[0].children[1].value.split(" ");
        let Bonus = this.doc.children[i+1].children[0].children[2].value.split(" ");
        let Result = [];
        for (let i = 0; i < Modifiers.length; i++) if (Bonus[i] == undefined) Bonus.push(0);
        if (i == 1) {
            if (this.DiceBoxes[i].includes(1) && this.DiceBoxes[i].includes(2) || !this.DiceBoxes[i].includes(1) && !this.DiceBoxes[i-1].includes(2)) for (j in Modifiers.length) {
                Result.push([]);
                for (k in this.DiceBoxes[i].length-2) {
                    Result[j].push(Math.floor((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[j] * 0.2), 1) + Modifiers[j] * 1 + Bonus[j] * 1);
                }
            }
            else if (this.DiceBoxes[i].includes(1)) {Result[i].push((Math.floor((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[i] * 0.2), 1) + Modifiers[i] * 1 + Bonus[i] * 1) * 2);}
            else {Result[i].push(Math.floor(Math.floor(((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[i] * 0.2), 1) + Modifiers[i] * 1 + Bonus[i] * 1) * 0.5));}
        }
        this.doc.children[i].children[0].children[3].value = Result.join("|");
    }
}

var NumOfDiceRollers = 0;
let DiceRollerArray = [0];
function addDiceRoller() {
    NumOfDiceRollers += 1;
    DiceRoller = document.getElementById(0).cloneNode(true);
    DiceRoller.id = NumOfDiceRollers;
    DiceRoller.className = "DiceRollerMain";
    document.getElementById("main").append(DiceRoller);
    DiceRollerArray.push(new diceRoller(NumOfDiceRollers));
} addDiceRoller();

function CalculateResult(id, index) {
    let DiceCount = [];
    let ADV = false;
    let DADV = false;
    let Modifiers = document.getElementById(id).children[1].children[0].children[1].value.split(" ")
    let Bonus = document.getElementById(id).children[1].children[0].children[2].value.split(" ")
    let Result = [];
    
    if (index == 1) {
        for (let i = 0; i < document.getElementById(id).children[1].children[0].children[0].getElementsByTagName("*").length; i++) {
                if (document.getElementById(id).children[1].children[0].children[0].getElementsByTagName("*")[i].textContent == "d10") {DiceCount.push(1);}
                else if (document.getElementById(id).children[1].children[0].children[0].getElementsByTagName("*")[i].textContent == "ADV") {ADV = true;}
                else if (document.getElementById(id).children[1].children[0].children[0].getElementsByTagName("*")[i].textContent == "DADV") {DADV = true;}
            }
        for (let i = 0; i < Modifiers.length; i++) {
            if (Bonus[i] == undefined) {Bonus.push(0);}
        }
        for (let i = 0; i < Modifiers.length; i++) {
            Result.push([]);
            for (let j = 0; j < DiceCount.length; j++) {
                if (ADV == false && DADV == false || ADV == true && DADV == true) {Result[i].push(Math.floor((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[i] * 0.2), 1) + Modifiers[i] * 1 + Bonus[i] * 1);}
                else if (ADV == true) {Result[i].push((Math.floor((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[i] * 0.2), 1) + Modifiers[i] * 1 + Bonus[i] * 1) * 2);}
                else if (DADV == true) {Result[i].push(Math.floor(Math.floor(((Math.random() * 10) + 1) * Math.max(Math.floor(Modifiers[i] * 0.2), 1) + Modifiers[i] * 1 + Bonus[i] * 1) * 0.5));}
            }
        }
    } else if (index == 2) {

    } else if (index == 3) {

    } else if (index == 4) {
        document.getElementById(id).children[index].children[0].children[0].value = "";
        document.getElementById(id).children[index].children[0].children[3].value = "Result";
    }
    document.getElementById(id).children[index].children[0].children[3].value = Result.join("|");
    
}

</script>

</html>