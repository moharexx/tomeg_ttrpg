<html>

<style>

.Hidden {
    display: none;
}

.DiceRollerMain {
    display: inline-table;
    width: 50%;
    height: 10%;
    margin-bottom: 1%;
    background-color: wheat;
    border: 1px solid black;
}
.DiceRollerMain input, button, p {
    display: inline-flex;
    margin: 0.5%;
    background-color: antiquewhite;
    border-collapse: collapse;
    border: 1px solid black;
}

.DiceRollerMain input[type="text"][disabled]{
    color: black;
}
.DiceRollerMain button:hover, .Log button:hover{
    background-color: rgb(230, 215, 195);
}

.DiceRollerTop {
    display: flex;
    width: 100%;
    height: 33%;
}
.DiceRollerTop input{
    width: 50%;
}
.DiceRollerTop :nth-child(1n){
    margin: 0% !important;
    border-width: 0px 1px 1px 0px !important;
}
.DiceRollerTop :last-child{
    border-width: 0px 0px 1px 0px !important;
}
.DiceRollerTop button{
    width: 20%;
    height: 100%;
}

.DiceRollerTopSelected {
    background-color: wheat !important;
    border: 1px solid black !important;
    border-bottom: 0px !important;
}
.DiceRollerTopSelected:hover{
    background-color: rgb(225, 202, 159) !important;
}

.selctedDiv {
    display: block;
    width: 100%;
    height: 100%;
}
.unslectedDiv {
    display: none;
    width: 0%;
    height: 0%;
}

.selctedDiv p {
    margin: 0.5%;
    width: 40%;
    max-height: 33%;
}
.selctedDiv :first-child input {
    width: 20%;
    height: 25%;
}

.Log {
    display: inline-flex;
    width: 49%;
    height: 10%;
    overflow-y: scroll;
    margin-bottom: 1%;
    background-color: wheat;
    border: 1px solid black;
}
.Log div {
    display: block;
    width: 100%;
}
.Log button, .Log p {
    width: max-content;
    margin: 0.5%;
    background-color: antiquewhite;
    border-collapse: collapse;
    border: 1px solid black;
}

.CostumDiceBox {
    display: inline-flex;
    width: 20%;
    margin-top: auto;
    margin-bottom: auto;
    margin-right: 0.5%;
    max-height: 1.1rem;
    background-color: antiquewhite;
    border: 1px solid black;
}
.CostumDiceBox input {
    width: 62.5%;
    border: none;
}

.dieNumBox {
    width: 5%;
    height: 1.2rem;
}

.RollBox {
    display: inline-flex;
    width: 28%;
    margin-top: auto;
    margin-bottom: auto;
    max-height: 1.1rem;
    background-color: antiquewhite;
    border: 1px solid black;
}

</style>

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="../assets/icon.png">
    <link rel="stylesheet" href="../assets/style_main.css">
    <script src="../assets/script_main.js"></script>
    <title>Digital Dice Roller</title>
</head>

<body>
    <header>
        <div onclick="side_bar_func()" class="side_menu_button"><img src="./../assets/icon_cog.png" alt=""></div>
        <div onclick="go_to('main/main.html')">Main Page</div>
        <div onclick="go_to('main/mechanics.html')">Mechanics</div>
        <div onclick="go_to('main/abilities.html')">Abilities</div>
        <div onclick="go_to('main/extra.html')">Extra</div>
    </header>
    <side_orb id="side_orb" onclick="side_bar_func(true)"></side_orb>
    <side_menu id="side_menu"></side_menu>
    <main id="main" onclick="side_bar_func(false)">
        <h1>DIGITAL DICE ROLLER</h1>
        <hr/>
        <br/>
        <input type="button" value="Save">
        <input type="button" value="Load">
        <input type="button" value="Add Dice Roller" onclick="addDiceRoller()">
        <input type="button" value="Delete Dice Roller">
        <br/><br/><hr>
        <div id="0">
            <div class="Hidden">
                <div class="DiceRollerTop">
                    <input type="text" name="Name" placeholder="Name" onchange="DiceRollerArray[this.parentElement.parentElement.parentElement.id].name = this.value">
                    <button class="DiceRollerTopSelected" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(1)">d10</button>
                    <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(2)">Damage</button>
                    <button class="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.id].switchRollerType(3)">Stable</button>
                </div>
                <div class="selctedDiv">
                    <div style="display: flex;">
                        <p></p>
                        <input type="text" name="d10Modifier" placeholder="Modifier">
                        <input type="text" name="d10Bonus" placeholder="Bonus">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <input class="dieNumBox" type="text" placeholder="#dice" onkeyup="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].numDice(0, this.value)">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(0, this.innerHTML.split('d'))">d10</button>
                        <div class="CostumDiceBox"><button>s</button><input type="text"><button>Add</button></div>
                        <div class="RollBox">
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(0, 1)">Roll</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(0, 2)">Advantage</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(0, 0.5)">Disadvantage</button>
                        </div>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(0)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ToggleLog(0)">Log</button>
                    </div>
                </div>
                <div class="unslectedDiv">
                    <div style="display: flex;">
                        <p></p>
                        <input type="text" name="DamageMultiplier" placeholder="Multiplier">
                        <input type="text" name="DamageBonus" placeholder="Bonus">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <input class="dieNumBox" type="text" placeholder="#dice" onkeyup="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].numDice(1, this.value)">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d4</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d6</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d8</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d10</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d12</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(1, this.innerHTML.split('d'))">d20</button>
                        <div class="RollBox">
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(1, 1)">Roll</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(1, 2)">CRIT!</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(1, 3)">×3 CRIT!</button>
                        </div>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(1)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ToggleLog(1)">Log</button>
                    </div>
                </div>
                <div class="unslectedDiv">
                    <div style="display: flex;">
                        <p></p>
                        <input type="text" name="StableMultiplier" placeholder="Multiplier">
                        <input type="text" name="StableModifier" placeholder="Modifier">
                        <input type="text" value="Result" disabled>
                    </div>
                    <div style="display: flex;">
                        <input class="dieNumBox" type="text" placeholder="#dice" onkeyup="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].numDice(2, this.value)">
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].addDice(2, this.innerHTML.split('d'))">d10</button>
                        <div class="RollBox">
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(2, 1)">Roll</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(2, 2)">Advantage</button>
                            <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].CalculateResult(2, 0.5)">Disadvantage</button>
                        </div>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ClearBox(2)">Clear</button>
                        <button onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].ToggleLog(2)">Log</button>
                    </div>
                </div>
            </div>
            <div class="Hidden">
                <div>
                    <div>
                        <button>delete</button>
                        <button name="0" style="float: right;" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.id].OrderLog(this.name)">Order: Right -> Down</button>
                    </div>
                    <div>
                        <p>The Roll Log is empty</p>
                    </div>
                </div>
            </div>
        </div>
        <button class="Hidden" id="DiceButton" name="" value="" onclick="DiceRollerArray[this.parentElement.parentElement.parentElement.parentElement.parentElement.id].removeElement(this.name, this.value), this.remove()"></button>
    </main>
</body>

<script>

class diceRoller {
    constructor(id) {
        this.id = id;
        this.name = "";
        this.CurrentRollerType = 1;
        this.doc = document.getElementById(id);
        this.DiceBoxes = [ [0], [0], [0] ];
        this.DiceBoxesIndex = [ 1, 1, 1 ];
        this.Multiplier = [ 1, 1, 1 ];
        this.LogOpened = false;
        this.LogOrder = "inline-table";
    }
    switchRollerType(i) {
        if (this.CurrentRollerType != i) {
            this.doc.children[0].children[0].children[this.CurrentRollerType].className = "";
            this.doc.children[0].children[0].children[i].className = "DiceRollerTopSelected";
            this.doc.children[0].children[this.CurrentRollerType].className = "unslectedDiv";
            this.doc.children[0].children[i].className = "selctedDiv";
            this.CurrentRollerType = i;
        }
    }
    numDice(index, Num) {
        if (index != 1) {
            if (Number(Num) == Number(Num) && Num != 0 && Num != 1) {
                this.doc.children[0].children[index+1].children[1].children[1].innerHTML = Num + "d10";
            } else {
                this.doc.children[0].children[index+1].children[1].children[1].innerHTML = "d10";
            }
        } else {
            if (Number(Num) == Number(Num) && Num != 0 && Num != 1) {
                let DiceArray = [0, 4, 6, 8, 10, 12, 20]
                for (let i = 1; i < 7; i++) this.doc.children[0].children[index+1].children[1].children[i].innerHTML = Num + "d" + DiceArray[i];
            } else {
                let DiceArray = [0, 4, 6, 8, 10, 12, 20]
                for (let i = 1; i < 6; i++)this.doc.children[0].children[index+1].children[1].children[1].innerHTML = "d" + DiceArray[i];
            }
        }
    }
    addDice(i, Dice) {
        let DiceButton = document.getElementById("DiceButton").cloneNode(true);
        DiceButton.name = i;
        DiceButton.className = "";
        if (Dice[0] == 0) this.DiceBoxes[i].push([1, Dice[1]])
        else this.DiceBoxes[i].push(Dice);
        DiceButton.value = this.DiceBoxesIndex[i];
        this.DiceBoxesIndex[i] += 1;
        DiceButton.innerHTML = Dice[0]+"d"+Dice[1];
        this.doc.children[0].children[i+1].children[0].children[0].appendChild(DiceButton);
    }
    removeElement(i, Dice) {
        if (Dice == 0) {this.Multiplier[i] = 1; this.doc.children[0].children[1*i+1].children[0].children[0].getElementsByTagName("*")[0].remove()}
        else delete this.DiceBoxes[i][Dice];
    }
    CalculateResult(index, Multiplier) {
        let Modifiers = this.doc.children[0].children[index+1].children[0].children[1].value.split(" ").filter(a => a);
        let Bonus = this.doc.children[0].children[index+1].children[0].children[2].value.split(" ").filter(a => a);
        let DiceBox = this.DiceBoxes[index].filter(a => a);
        let Result = [];
        let NatResults = [];
        let LogMult = "";

        if (index == 1) {if (Modifiers.length < 1) Modifiers.push(1)} else {if (Modifiers.length < 1) Modifiers.push(0)}
        for (let i = 0; i < Modifiers.length; i++) if (Bonus[i] == undefined) Bonus.push(0);
        for (let i = 0; i < DiceBox.length; i++) {
            Result.push([]);
            let rolledDice = [];
            for (let j = 0; j < DiceBox[i][0]; j++) {
                let tempDice = Math.floor(Math.random() * DiceBox[i][1] + 1)
                rolledDice.push(tempDice);
                NatResults.push(tempDice);
            }
            rolledDice = rolledDice.reduce((a, b) => a+b, 0);
            if (index == 0) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor(((rolledDice * Math.max(1, Math.floor(Modifiers[j] * 0.2))) + Modifiers[j]*1 + Bonus[j]*1) * Multiplier));
                }
            } else if (index == 1) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor((rolledDice * Modifiers[j]*1 + Bonus[j]*1) * Multiplier));
                }
            } else if (index == 2) {
                for (let j = 0; j < Modifiers.length; j++) {
                    Result[i].push(Math.floor((rolledDice * Multiplier) + Modifiers[j]*1 + Bonus[j]*1));
                }
            }
        }
        if (Result != "") this.doc.children[0].children[index+1].children[0].children[3].value = Result.join("|");

        let Dices = String(DiceBox);
        for (let i = 0; i < DiceBox.length*2; i++) {
            if (i % 2 == 0) Dices = Dices.replace(",", "d");
            else Dices = Dices.replace(",", " ");
        }
        if (index != 1 && Multiplier == 2) LogMult = "AVD";
        else if (index != 1 && Multiplier == 0.5) LogMult = "DAVD";
        else if (index == 1 && Multiplier == 2) LogMult = "×2";
        else if (index == 1 && Multiplier == 3) LogMult = "×3";
        
        if (this.doc.children[1].children[0].children[1].innerHTML.includes("The Roll Log is empty") && Result != "") this.doc.children[1].children[0].children[1].innerHTML = `<p style="display: ${this.LogOrder};">${Dices} N${NatResults}: M${Modifiers} B${Bonus} ${LogMult} [ ${Result} ]</p>`;
        else if (Result != "") this.doc.children[1].children[0].children[1].innerHTML += `<p style="display: ${this.LogOrder};">${Dices} N${NatResults}: M${Modifiers} B${Bonus} ${LogMult} [ ${Result} ]</p>`;
    }
    ClearBox(i) {
        this.DiceBoxes[i] = [0];
        this.DiceBoxesIndex[i] = [1];
        this.Multiplier[i] = [1];
        this.doc.children[0].children[i+1].children[0].children[0].innerHTML = "";
        this.doc.children[0].children[i+1].children[0].children[1].value = "";
        this.doc.children[0].children[i+1].children[0].children[2].value = "";
        this.doc.children[0].children[i+1].children[0].children[3].value = "Result";
    }
    ToggleLog(index) {
        if (this.LogOpened == false) {
            this.LogOpened = true;
            this.doc.children[1].className = "Log";
        } else {
            this.LogOpened = false;
            this.doc.children[1].className = "Hidden";
        }
    }
    OrderLog(Order) {
        if (Order == 0) {
            this.doc.children[1].children[0].children[0].children[1].name = 1;
            for (let i = 0; i < this.doc.children[1].children[0].children[1].childElementCount; i++) this.doc.children[1].children[0].children[1].children[i].style.display = "block";
            this.doc.children[1].children[0].children[0].children[1].innerHTML = "Order: Down";
            this.LogOrder = "block";
        } else {
            this.doc.children[1].children[0].children[0].children[1].name = 0;
            for (let i = 0; i < this.doc.children[1].children[0].children[1].childElementCount; i++) this.doc.children[1].children[0].children[1].children[i].style.display = "inline-table";
            this.doc.children[1].children[0].children[0].children[1].innerHTML = "Order: Right -> Down";
            this.LogOrder = "inline-table";
        }
    }
}

var NumOfDiceRollers = 0;
let DiceRollerArray = [0];
function addDiceRoller() {
    NumOfDiceRollers += 1;
    DiceRoller = document.getElementById(0).cloneNode(true);
    DiceRoller.id = NumOfDiceRollers;
    DiceRoller.style.dislpay = "inline-block";
    DiceRoller.children[0].className = "DiceRollerMain";
    document.getElementById("main").append(DiceRoller);
    DiceRollerArray.push(new diceRoller(NumOfDiceRollers));
} addDiceRoller();

</script>

</html>